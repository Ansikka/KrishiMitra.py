import streamlit as st
from datetime import datetime
from gtts import gTTS
import base64
import os

# ------------------ Utility Function ------------------
def play_audio(text, lang_code='en'):
    try:
        tts = gTTS(text=text, lang=lang_code)
        filename = "temp_audio.mp3"
        tts.save(filename)
        with open(filename, "rb") as audio_file:
            audio_bytes = audio_file.read()
        b64 = base64.b64encode(audio_bytes).decode()
        audio_html = f'<audio autoplay="true" controls="controls"><source src="data:audio/mp3;base64,{b64}" type="audio/mp3"></audio>'
        st.markdown(audio_html, unsafe_allow_html=True)
        os.remove(filename)
    except Exception as e:
        st.error("Text-to-Speech is not available for this language.")

# ------------------ Language Data ------------------
LANGUAGE_DATA = {
    "English": {
        "tts_lang": "en",
        "welcome": "ЁЯМ╛ Welcome to KrishiMitra!",
        "today_task": "ЁЯУЛ Your task for today:",
        "no_task": "тЪая╕П No specific task for today.",
        "price_info": "ЁЯТ╕ Mandi price information:",
        "disease_detected": "ЁЯМ┐ Crop disease detected:",
        "govt_scheme": "ЁЯУК Government scheme details:",
        "weather": "тШАя╕П Today's Weather:",
        "chat": "ЁЯдЦ Farmer Help Chatbot",
        "ask_question": "Ask a question",
        "fertilizer": "ЁЯМ▒ Fertilizer Recommendation",
        "loan": "ЁЯПж Loan/Subsidy Checker",
        "weather_alert": "ЁЯМзя╕П Weather Alerts",
        "crop_calendar": "ЁЯУЕ Crop Calendar"
    },
    "Hindi": {
        "tts_lang": "hi",
        "welcome": "ЁЯМ╛ рдХреГрд╖рд┐ рдорд┐рддреНрд░ рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ!",
        "today_task": "ЁЯУЛ рдЖрдЬ рдХреЗ рд▓рд┐рдП рдЖрдкрдХрд╛ рдХрд╛рд░реНрдп:",
        "no_task": "тЪая╕П рдЖрдЬ рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реИред",
        "price_info": "ЁЯТ╕ рдордВрдбреА рдореВрд▓реНрдп рдЬрд╛рдирдХрд╛рд░реА:",
        "disease_detected": "ЁЯМ┐ рдлрд╕рд▓ рд░реЛрдЧ рдХрд╛ рдкрддрд╛ рдЪрд▓рд╛:",
        "govt_scheme": "ЁЯУК рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛ рд╡рд┐рд╡рд░рдг:",
        "weather": "тШАя╕П рдЖрдЬ рдХрд╛ рдореМрд╕рдо:",
        "chat": "ЁЯдЦ рдХрд┐рд╕рд╛рди рд╕рд╣рд╛рдпрдХ рдЪреИрдЯрдмреЙрдЯ",
        "ask_question": "рдХреЛрдИ рдкреНрд░рд╢реНрди рдкреВрдЫреЗрдВ",
        "fertilizer": "ЁЯМ▒ рдЙрд░реНрд╡рд░рдХ рд╕рд┐рдлрд╛рд░рд┐рд╢",
        "loan": "ЁЯПж рдЛрдг/рд╕рдмреНрд╕рд┐рдбреА рдЬрд╛рдВрдЪ",
        "weather_alert": "ЁЯМзя╕П рдореМрд╕рдо рдЕрд▓рд░реНрдЯ",
        "crop_calendar": "ЁЯУЕ рдлрд╕рд▓ рдХреИрд▓реЗрдВрдбрд░"
    },
    "Bhojpuri": {
        "tts_lang": "hi",
        "welcome": "ЁЯМ╛ рдХреГрд╖рд┐рдорд┐рддреНрд░ рдореЗрдВ рд░рдЙрдЖ рд╕реНрд╡рд╛рдЧрдд рдмрд╛!",
        "today_task": "ЁЯУЛ рдЖрдЬ рдХреЗ рдХрд╛рдо:",
        "no_task": "тЪая╕П рдЖрдЬ рдХрд╡рдиреЛ рдЦрд╛рд╕ рдХрд╛рдо рдирдЗрдЦреЗред",
        "price_info": "ЁЯТ╕ рдордВрдбреА рдХреЗ рджрд╛рдо рдЬрд╛рдирдХрд╛рд░реА:",
        "disease_detected": "ЁЯМ┐ рдлрд╕рд▓ рдХреЗ рдмреАрдорд╛рд░реА рдкрд╛рдЗрд▓ рдЧрдЗрд▓:",
        "govt_scheme": "ЁЯУК рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛ рд╡рд┐рд╡рд░рдг:",
        "weather": "тШАя╕П рдЖрдЬ рдХреЗ рдореМрд╕рдо:",
        "chat": "ЁЯдЦ рдХрд┐рд╕рд╛рди рдорджрдж рдЪреИрдЯрдмреЙрдЯ",
        "ask_question": "рдХреЛрдИ рд╕рд╡рд╛рд▓ рдкреВрдЫреАрдВ",
        "fertilizer": "ЁЯМ▒ рдЦрд╛рдж рд╕рд┐рдлрд╛рд░рд┐рд╢",
        "loan": "ЁЯПж рдХрд░реНрдЬ/рд╕рдмреНрд╕рд┐рдбреА рдЬрд╛рдВрдЪ",
        "weather_alert": "ЁЯМзя╕П рдореМрд╕рдо рдЪреЗрддрд╛рд╡рдиреА",
        "crop_calendar": "ЁЯУЕ рдлрд╕рд▓ рдХреИрд▓реЗрдВрдбрд░"
    },
    "Punjabi": {
        "tts_lang": "pa",
        "welcome": "ЁЯМ╛ риХрйНри░ри┐ри╕ри╝рйА риори┐ридри░ ри╡ри┐рй▒риЪ ридрйБри╣ри╛рибри╛ ри╕рйБриЖриЧрид ри╣рйИ!",
        "today_task": "ЁЯУЛ риЕрй▒риЬ ри▓риИ ридрйБри╣ри╛рибри╛ риХрй░рио:",
        "no_task": "тЪая╕П риЕрй▒риЬ риХрйЛриИ ри╡ри┐ри╢рйЗри╕ри╝ риХрй░рио риири╣рйАриВ ри╣рйИред",
        "price_info": "ЁЯТ╕ риорй░рибрйА риорйБрй▒ри▓ риЬри╛ригриХри╛ри░рйА:",
        "disease_detected": "ЁЯМ┐ рилри╕ри▓ рижрйА римри┐риори╛ри░рйА рижрйА рикриЫри╛риг ри╣рйЛриИ:",
        "govt_scheme": "ЁЯУК ри╕ри░риХри╛ри░рйА рипрйЛриЬриири╛ ри╡рйЗри░ри╡ри╛:",
        "weather": "тШАя╕П риЕрй▒риЬ рижри╛ риорйМри╕рио:",
        "chat": "ЁЯдЦ риХри┐ри╕ри╛рии ри╕ри╣ри╛риЗридри╛ риЪрйИриЯримрйМриЯ",
        "ask_question": "риЗрй▒риХ ри╕ри╡ри╛ри▓ рикрйБрй▒риЫрйЛ",
        "fertilizer": "ЁЯМ▒ риЦри╛риж ри╕ри┐рилри╛ри░ри╕ри╝",
        "loan": "ЁЯПж риХри░риЬри╝ри╛ риЬри╛риВ ри╕римри╕ри┐рибрйА риЪрйИрй▒риХри░",
        "weather_alert": "ЁЯМзя╕П риорйМри╕рио рижрйА риЪрйЗридри╛ри╡риирйА",
        "crop_calendar": "ЁЯУЕ рилри╕ри▓ риХрйИри▓рй░рибри░"
    },
    "Tamil": {
        "tts_lang": "ta",
        "welcome": "ЁЯМ╛ роХро┐ро░рпБро╖ро┐рооро┐родрпНро░ро╛ро╡ро┐ро▒рпНроХрпБ ро╡ро░ро╡рпЗро▒рпНроХро┐ро▒рпЛроорпН!",
        "today_task": "ЁЯУЛ роЗройрпНро▒рпИроп роЙроЩрпНроХро│рпН ро╡рпЗро▓рпИ:",
        "no_task": "тЪая╕П роЗройрпНро▒рпИроХрпНроХрпБ роЪро┐ро▒рокрпНрокрпБ ро╡рпЗро▓рпИ роЗро▓рпНро▓рпИ.",
        "price_info": "ЁЯТ╕ роорогрпНроЯро┐ ро╡ро┐ро▓рпИ родроХро╡ро▓рпН:",
        "disease_detected": "ЁЯМ┐ рокропро┐ро░рпН роирпЛропрпН роХрогрпНроЯро▒ро┐ропрокрпНрокроЯрпНроЯродрпБ:",
        "govt_scheme": "ЁЯУК роЕро░роЪрпБ родро┐роЯрпНроЯ ро╡ро┐ро╡ро░роЩрпНроХро│рпН:",
        "weather": "тШАя╕П роЗройрпНро▒рпИроп ро╡ро╛ройро┐ро▓рпИ:",
        "chat": "ЁЯдЦ ро╡ро┐ро╡роЪро╛роп роЙродро╡ро┐ роЪроирпНродрпИ",
        "ask_question": "роТро░рпБ роХрпЗро│рпНро╡ро┐ роХрпЗро│рпБроЩрпНроХро│рпН",
        "fertilizer": "ЁЯМ▒ роЙро░ рокро░ро┐роирпНродрпБро░рпИ",
        "loan": "ЁЯПж роХроЯройрпН/роЙродро╡ро┐ родроХрпБродро┐",
        "weather_alert": "ЁЯМзя╕П ро╡ро╛ройро┐ро▓рпИ роОроЪрпНроЪро░ро┐роХрпНроХрпИ",
        "crop_calendar": "ЁЯУЕ рокропро┐ро░рпН роиро╛роЯрпНроХро╛роЯрпНроЯро┐"
    },
    "Telugu": {
        "tts_lang": "te",
        "welcome": "ЁЯМ╛ р░Хр▒Гр░╖р░┐р░ор░┐р░др▒Нр░░р░╛ р░Хр▒Б р░╕р▒Нр░╡р░╛р░Чр░др░В!",
        "today_task": "ЁЯУЛ р░Ир░░р▒Лр░Ьр▒Б р░ор▒А р░кр░ир░┐:",
        "no_task": "тЪая╕П р░И р░░р▒Лр░Ьр▒Б р░кр▒Нр░░р░др▒Нр░пр▒Зр░Хр░ор▒Ир░и р░кр░ир░┐ р░▓р▒Зр░жр▒Б.",
        "price_info": "ЁЯТ╕ р░ор░Вр░бр▒А р░зр░░р░▓ р░╕р░ор░╛р░Ър░╛р░░р░В:",
        "disease_detected": "ЁЯМ┐ р░кр░Вр░Я р░╡р▒Нр░пр░╛р░зр░┐ р░Чр▒Бр░░р▒Нр░др░┐р░Вр░Ър░мр░бр░┐р░Вр░жр░┐:",
        "govt_scheme": "ЁЯУК р░кр▒Нр░░р░нр▒Бр░др▒Нр░╡р░В р░кр░ер░Х р░╡р░┐р░╡р░░р░╛р░▓р▒Б:",
        "weather": "тШАя╕П р░Ир░░р▒Лр░Ьр▒Б р░╡р░╛р░др░╛р░╡р░░р░гр░В:",
        "chat": "ЁЯдЦ р░░р▒Ир░др▒Б р░╕р░╣р░╛р░п р░Ър░╛р░Яр▒Нр░мр░╛р░Яр▒Н",
        "ask_question": "р░кр▒Нр░░р░╢р▒Нр░ир░ир▒Б р░Ер░бр░Чр░Вр░бр░┐",
        "fertilizer": "ЁЯМ▒ р░Ор░░р▒Бр░╡р▒Б р░╕р░┐р░лр░╛р░░р▒Нр░╕р▒Б",
        "loan": "ЁЯПж р░░р▒Бр░гр░В/р░Йр░кр░╕р░Вр░╣р░░р░г р░др░ир░┐р░Цр▒А",
        "weather_alert": "ЁЯМзя╕П р░╡р░╛р░др░╛р░╡р░░р░г р░╣р▒Жр░Ър▒Нр░Ър░░р░┐р░Х",
        "crop_calendar": "ЁЯУЕ р░кр░Вр░Я р░Хр▒Нр░пр░╛р░▓р▒Жр░Вр░бр░░р▒Н"
    },
    "Kannada": {
        "tts_lang": "kn",
        "welcome": "ЁЯМ╛ р▓Хр│Гр▓╖р▓┐ р▓ор▓┐р▓др│Нр▓░р▓Хр│Нр▓Хр│Ж р▓╕р│Нр▓╡р▓╛р▓Чр▓д!",
        "today_task": "ЁЯУЛ р▓Зр▓Вр▓жр▓┐р▓и р▓ир▓┐р▓ор│Нр▓о р▓Хр│Жр▓▓р▓╕:",
        "no_task": "тЪая╕П р▓Зр▓Вр▓жр│Б р▓пр▓╛р▓╡р│Бр▓жр│З р▓╡р▓┐р▓╢р│Зр▓╖ р▓Хр│Жр▓▓р▓╕р▓╡р▓┐р▓▓р│Нр▓▓.",
        "price_info": "ЁЯТ╕ р▓ор▓Вр▓бр▓┐ р▓мр│Жр▓▓р│Ж р▓ор▓╛р▓╣р▓┐р▓др▓┐:",
        "disease_detected": "ЁЯМ┐ р▓мр│Жр▓│р│Ж р▓░р│Лр▓Ч р▓кр▓др│Нр▓др│Жр▓╣р▓Ър│Нр▓Ър▓▓р▓╛р▓Чр▓┐р▓жр│Ж:",
        "govt_scheme": "ЁЯУК р▓╕р▓░р▓Хр▓╛р▓░р▓┐ р▓пр│Лр▓Ьр▓ир│Ж р▓╡р▓┐р▓╡р▓░р▓Чр▓│р│Б:",
        "weather": "тШАя╕П р▓Зр▓Вр▓жр▓┐р▓и р▓╣р▓╡р▓╛р▓ор▓╛р▓и:",
        "chat": "ЁЯдЦ р▓░р│Ир▓д р▓╕р▓╣р▓╛р▓п р▓Ър▓╛р▓Яр│НтАМр▓мр▓╛р▓Яр│Н",
        "ask_question": "р▓кр│Нр▓░р▓╢р│Нр▓ир│Ж р▓Хр│Зр▓│р▓┐",
        "fertilizer": "ЁЯМ▒ р▓░р▓╕р▓Чр│Кр▓мр│Нр▓мр▓░ р▓╢р▓┐р▓лр▓╛р▓░р▓╕р│Б",
        "loan": "ЁЯПж р▓╕р▓╛р▓▓/р▓╕р▓мр│Нр▓╕р▓┐р▓бр▓┐ р▓др▓кр▓╛р▓╕р▓гр│Ж",
        "weather_alert": "ЁЯМзя╕П р▓╣р▓╡р▓╛р▓ор▓╛р▓и р▓Ор▓Ър│Нр▓Ър▓░р▓┐р▓Хр│Ж",
        "crop_calendar": "ЁЯУЕ р▓мр│Жр▓│р│Ж р▓Хр│Нр▓пр▓╛р▓▓р│Жр▓Вр▓бр▓░р│Н"
    },
    "Awadhi": {
        "tts_lang": "hi",
        "welcome": "ЁЯМ╛ рдХреГрд╖рд┐рдорд┐рддреНрд░ рдорд╛ рддреЛрд╣рд╛рд░ рд╕реНрд╡рд╛рдЧрдд рдмрд╛!",
        "today_task": "ЁЯУЛ рдЖрдЬреБ рдХреЗ рддреЛрд╣рд╛рд░ рдХрд╛рдо:",
        "no_task": "тЪая╕П рдЖрдЬреБ рдХрдЙрдиреЛрдВ рдЦрд╛рд╕ рдХрд╛рдо рдирд╛рд╣реА рдмрд╛ред",
        "price_info": "ЁЯТ╕ рдордВрдбреА рднрд╛рд╡ рдЬрд╛рдирдХрд╛рд░реА:",
        "disease_detected": "ЁЯМ┐ рдлрд╕рд▓ рдХреЗ рд░реЛрдЧ рдорд┐рд▓рд▓ рдмрд╛:",
        "govt_scheme": "ЁЯУК рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛ рд╡рд┐рд╡рд░рдг:",
        "weather": "тШАя╕П рдЖрдЬреБ рдХреЗ рдореМрд╕рдо:",
        "chat": "ЁЯдЦ рдХрд┐рд╕рд╛рди рд╕рд╣рд╛рдпрддрд╛ рдЪреИрдЯрдмреЙрдЯ",
        "ask_question": "рдкреНрд░рд╢реНрди рдкреВрдЫреАрдВ",
        "fertilizer": "ЁЯМ▒ рдЦрд╛рдж рд╕реБрдЭрд╛рд╡",
        "loan": "ЁЯПж рдХрд░реНрдЬ/рд╕рдмреНрд╕рд┐рдбреА рдЬрд╛рдВрдЪ",
        "weather_alert": "ЁЯМзя╕П рдореМрд╕рдо рд╕реВрдЪрдирд╛",
        "crop_calendar": "ЁЯУЕ рдлрд╕рд▓ рдХреИрд▓реЗрдВрдбрд░"
    },
        "Malayalam": {
        "tts_lang": "ml",
        "welcome": "ЁЯМ╛ р┤Хр╡Гр┤╖р┤┐р┤ор┤┐р┤др╡Нр┤░р┤пр┤┐р┤▓р╡Зр┤Хр╡Нр┤Хр╡Н р┤╕р╡Нр┤╡р┤╛р┤Чр┤др┤В!",
        "today_task": "ЁЯУЛ р┤Зр┤ир╡Нр┤ир┤др╡Нр┤др╡Ж р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤Ьр╡Лр┤▓р┤┐:",
        "no_task": "тЪая╕П р┤Зр┤ир╡Нр┤ир╡Н р┤кр╡Нр┤░р┤др╡Нр┤пр╡Зр┤Х р┤Ьр╡Лр┤▓р┤┐р┤пр╡Кр┤ир╡Нр┤ир╡Бр┤ор┤┐р┤▓р╡Нр┤▓.",
        "price_info": "ЁЯТ╕ р┤ор┤╛р┤гр╡Нр┤Яр┤┐ р┤╡р┤┐р┤▓ р┤╡р┤┐р┤╡р┤░р┤Щр╡Нр┤Щр╡╛:",
        "disease_detected": "ЁЯМ┐ р┤╡р┤┐р┤│р┤пр┤┐р┤▓р╡Ж р┤░р╡Лр┤Чр┤В р┤Хр┤гр╡Нр┤Яр╡Жр┤др╡Нр┤др┤┐р┤пр┤┐р┤Яр╡Нр┤Яр╡Бр┤гр╡Нр┤Яр╡Н:",
        "govt_scheme": "ЁЯУК р┤╕р╡╝р┤Хр╡Нр┤Хр┤╛р╡╝ р┤кр┤жр╡Нр┤зр┤др┤┐р┤пр╡Бр┤Яр╡Ж р┤╡р┤┐р┤╢р┤жр┤╛р┤Вр┤╢р┤Щр╡Нр┤Щр╡╛:",
        "weather": "тШАя╕П р┤Зр┤ир╡Нр┤ир┤др╡Нр┤др╡Ж р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤е:",
        "chat": "ЁЯдЦ р┤Хр╡╝р┤╖р┤Х р┤╕р┤╣р┤╛р┤п р┤Ър┤╛р┤▒р╡Нр┤▒р╡НтАМр┤мр╡Лр┤Яр╡Нр┤Яр╡Н",
        "ask_question": "р┤Тр┤░р╡Б р┤Ър╡Лр┤жр╡Нр┤пр┤В р┤Ър╡Лр┤жр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х",
        "fertilizer": "ЁЯМ▒ р┤╡р┤│р┤В р┤╢р╡Бр┤кр┤╛р╡╝р┤╢",
        "loan": "ЁЯПж р┤▓р╡Лр╡║/р┤╕р┤мр╡Нр┤╕р┤┐р┤бр┤┐ р┤кр┤░р┤┐р┤╢р╡Лр┤зр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х",
        "weather_alert": "ЁЯМзя╕П р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤ер┤╛ р┤ор╡Бр┤ир╡Нр┤ир┤▒р┤┐р┤пр┤┐р┤кр╡Нр┤кр╡Н",
        "crop_calendar": "ЁЯУЕ р┤╡р┤┐р┤│р┤╡р╡Жр┤Яр╡Бр┤кр╡Нр┤кр╡Н р┤Хр┤▓р┤гр╡Нр┤Яр╡╝"
    }
}
def play_audio(text, lang_code='en'):
    try:
        tts = gTTS(text=text, lang=lang_code)
        filename = "temp_audio.mp3"
        tts.save(filename)
        with open(filename, "rb") as audio_file:
            audio_bytes = audio_file.read()
        b64 = base64.b64encode(audio_bytes).decode()
        audio_html = f'<audio autoplay="true" controls="controls"><source src="data:audio/mp3;base64,{b64}" type="audio/mp3"></audio>'
        st.markdown(audio_html, unsafe_allow_html=True)
        os.remove(filename)
    except Exception as e:
        st.error("Text-to-Speech is not available for this language.")

# ------------------ Streamlit Interface ------------------
st.set_page_config(page_title="KrishiMitra", layout="centered")
st.title("ЁЯМ╛ KrishiMitra ")

# Language Selector
lang_choice = st.selectbox("Choose your language / рдЕрдкрдиреА рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ:", list(LANGUAGE_DATA.keys()))
lang_data = LANGUAGE_DATA[lang_choice]

# Show Welcome Message
st.markdown(f"### {lang_data['welcome']}")
play_audio(lang_data["welcome"], lang_data["tts_lang"])

# Show all features in selected language
st.subheader(lang_data["today_task"])
st.markdown(f"- {lang_data['price_info']}")
st.markdown(f"- {lang_data['disease_detected']}")
st.markdown(f"- {lang_data['govt_scheme']}")
st.markdown(f"- {lang_data['weather']}")
st.markdown(f"- {lang_data['chat']}")
st.markdown(f"- {lang_data['fertilizer']}")
st.markdown(f"- {lang_data['loan']}")
st.markdown(f"- {lang_data['weather_alert']}")
st.markdown(f"- {lang_data['crop_calendar']}")

